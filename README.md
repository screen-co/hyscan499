# HyScan 4.99 #

HyScan 4.99 построен на библиотеках HyScan 5, но это ещё не HyScan 5.
Между тем, он позволяет на ежедневной основе работать с гидролокаторами,
датчиками и данными.

## Сборка ##

Сборка осуществляется в этапа:
 1. Склонировать hyscan-builder:
    ```bash
    git clone git@gitlab.screen-co.ru:hyscan/hyscan-builder.git
    ```
 2. Переключиться на ветвь wip/hyscan-499:
    ```bash
    git checkout wip/hyscan-499
    ```
 3. Склонировать все зависимости: `./manager clone`
 4. Собрать командой `make`
 5. Скопировать куда-нибудь конфигурационные файлы. Файлы лежат в папке
    `hyscan-499/example-ini`. Существует 2 типа конфигурационных файлов:
    - Профили оборудования описывают подключенное оборудование
      (см `default.ini`,  `dsse.ini`,  `flss.ini`,  `pf.ini`)
    - Параметры программы задают некоторые настройки программы (`config.ini`)
      В `config.ini` наиболее интересны 2 поля: `hardware` описывает профиль
      по умолчанию, `paths` пути к папкам с драйверами оборудования.
 6. Создать где-нибудь базу данных. Это просто папка, поэтому и создается она
    как папка: `mkdir /tmp/db`
 7. Всё готово. Можно запускать.

## Локализация ##

HyScan интернационален. Для этого он использует gettext. В настоящее время
локализованы само приложение, вспомогательная библиотека и модули интерфейса
приложения.

Для установки файлов локализации нужно **рядом с исполняемым файлом** создать
папки `ru/LC_MESSAGES` и положить в них `.mo`-файлы из:
- `fnn/po/ru`
- `libhyscanfnn/po/ru`
- `sw_ui/po/ru`

Так как я могу забыть обновить этот файл при интернационализации новых
библиотек, рекомендуется также поискать остальные файлы (`find . -name "*.mo"`)
и в случае обнаружения чего-то ещё дать мне знать. Впрочем, в дальнейшем
этот процесс будет автоматизирован.

### Кстати ###
> Очень важно запускать HyScan из той же папки, где и исполняемый файл.
> То есть `./hyscan499 ...` будет работать, а `./bin/hyscan499 ...` -- нет.
> Разумеется, это тоже будет починено вместе с автоматизацией, упомянутой выше.

## Модули интерфейса ##

На данный момент существует 3 модуля интерфейса:
1. hardware.ui - специализированный интерфейс для AME. Предназначен для БИУС ИРК
   и характерен тем, что его крайне неудобно использовать с мышкой, зато удобно
   использовать с кнопками вокруг экрана БИУС
2. software.ui - интерфейс для использования с мышкой, позволяющий отобразить
   все панели сразу
3. evo.ui - интерфейс для использования с мышкой с немного другой организацией:
   позволяет отобразить только одну панель за один раз

## Запуск ##

Если запустить `hyscan499` без ключей, будет показана небольшая подсказка.
Ниже я перечислю основные ключи.
- -d путь к БД, ожидает на вход строку вида `file://[relative-or-absolute-path]`
- -p путь к файлу с профилем оборудования (абсолютный или относительный)
- -o пути к драйверам устройств. Можно перечислять несколько раз: `-o=/home/ -o=.`
- -k задает путь к конфигурационному файлу *(о нем чуть позже, в следующем разделе)*
- -l задает путь к файлу с настройками (последний проект, настройки ГЛ и
  отображения). Если не задать, то будет автоматически использован файл 
  `hyscan499-settings.ini` в системной папке конфигурационных файлов.
- Семейство ключей: --ss, --ss-lo, --pf, --fl, --es задает отображаемые
  программой панели. Панель, по сути, является сочетанием виджета акустических
  данных, виджета настройки отображения и виджета управления локатором. Можно
  (и нужно) задавать несколько ключей, если требуется несколько панелей.
- --ui скрытый ключ (не показывается в подсказке), определяет используемый 
  модуль интерфейса

Например, лично я запускаю так:
```bash
./hyscan499 -d file:///home/dmitriev.a/dev/updb --ss --es -p flss.ini -k config.ini
```


## Параметры и переменные среды ##

Этот раздел содержит описание настроек (config.ini) и переменных среды.

### Переменные среды ###

| Переменная      | Эффект                                                   | Модуль интерфейса |
|-----------------|----------------------------------------------------------|-------------------|
| HY_PARAM        | Включает кнопку доступа к полным параметрам оборудования | evo, software     |
| FNN_BUTTON_SIZE | Задает размер HyScanFnnButton в пикселях                 | hardware          |

### Настройки ###

Есть возможность часть настроек передавать не через командную строку, а в конфигурационном
файле. Они все перечислены в группе common. 

| Группа | Название        | Что определяет                                                   |
|--------|-----------------|------------------------------------------------------------------|
| common | db-uri          | Путь к БД                                                        |
|        | cache           | Размер кэша (2 ГБ по умолчанию)                                  |
|        | hardware        | Профиль оборудования                                             |
|        | driver          | Список путей к драйверам (разделитель **;**)                     |
|        | settings        | Путь к файлу с настройками ГЛ.                                   |
| ame    | source_specific | Настройка приема кнопок по UDP                                   |
|        | button_addr     | Адрес приема кнопок по UDP                                       |
|        | button_port     | Порт приема кнопок по UDP                                        |
|        | mark_addr       | Адрес отправки меток по UDP                                      |
|        | mark_port       | Порт отправки меток по UDP                                       |
|        | depth_path      | Путь к **файлу** для выгрузки глубины                            |
|        | screenshot_dir  | Путь к **папке** для сохранения скриншотов (должна существовать) |
